@model List<Capstone.Models.OrdVini>

@{
    ViewBag.Title = "Details";
}

<h2 class="my-4">Il tuo Ordine</h2>

<p><strong>Nome:</strong> @Model[0].Ordini.Users.Nome</p>
<p><strong>Cognome:</strong> @Model[0].Ordini.Users.Cognome</p>
<p><strong>Indirizzo:</strong> @Model[0].Ordini.Indirizzo</p>
<p><strong>Stato:</strong> @Model[0].Ordini.Stato</p>

@if (Model.Any())
{
    <table class="table">
        <thead>
            <tr>
                <th>Articolo</th>
                <th>Quantità</th>
                <th>Prezzo Unitario</th>
                <th>Sconto Applicato (%)</th>
                <th>Prezzo Totale</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var vino in Model)
            {
                <tr>
                    <td>@vino.Vini.Nome</td>
                    <td>@vino.Quantita pz.</td>
                    <td>@(vino.Vini.Prezzo.ToString("0.##")) €</td>
                    <td>@(vino.Vini.Sconto?.ToString("0.##") ?? "0") %</td> <!-- Visualizza lo sconto, se presente, altrimenti mostra 0 -->
                    <td>@((vino.Vini.Prezzo * (1 - (vino.Vini.Sconto ?? 0) / 100) * vino.Quantita).ToString("0.##")) €</td>
                    <!-- Calcola il prezzo totale con lo sconto -->
                </tr>
            }
            <tr>
                <td style="height:75px; vertical-align: bottom;" colspan="4"><strong>Prezzo Totale:</strong></td>
                <td style="vertical-align: bottom;">
                    @(Model.Sum(item => (item.Vini.Prezzo * (1 - (item.Vini.Sconto ?? 0) / 100) * item.Quantita)).ToString("0.##")) € <!-- Calcola il prezzo totale dell'ordine -->
                </td>
            </tr>
        </tbody>
    </table>
    <div>
        <a href="/Ordini/Details/@User.Identity.Name" class="btn btn-outline-primary my-3">Torna allo Storico</a>
    </div>
}
else
{
    <p>Nessun articolo trovato per questo ordine.</p>
}
